const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{inject:["uipData","router","uipress","uiTemplate","layersPanel","unsavedChanges"],data:function(){return{loading:!0,firstRender:!1,templateID:this.$route.params.templateID,activeBlockID:!1,saving:!1,helpLoaded:!1,allUiTemplates:[],blockFrames:[],previewWidth:2e3,deviceSwitcherOpen:!1,domBlocks:[],isScrolling:!1,scrollDebounce:null,resizer:{startX:0,startY:0,width:0,height:0,resizing:!1,wrap:!1,uid:!1,block:!1,blockWidth:0,blockHeight:0,previewBlockWidth:0,previewBlockHeight:0},ui:{zoom:.9,zoomoptions:!1,viewDevice:"desktop",strings:{backToList:__("Exit builder","uipress-lite"),toggleLayers:__("Toggle layers panel","uipress-lite"),backToList:__("Back to template list","uipress-lite"),zoomIn:__("Zoom in","uipress-lite"),zoomOut:__("Zoom out","uipress-lite"),darkMode:__("Dark mode","uipress-lite"),preview:__("Preview","uipress-lite"),import:__("Import template","uipress-lite"),export:__("Export template","uipress-lite"),templateLibrary:__("Template Library","uipress-lite"),mobile:__("Mobile","uipress-lite"),desktop:__("Desktop","uipress-lite"),tablet:__("Tablet","uipress-lite"),saveTemplate:__("Save","uipress-lite"),help:__("Help","uipress-lite"),docs:__("Documentation and guides","uipress-lite"),active:__("Active","uipress-lite"),draft:__("Draft","uipress-lite"),newTemplate:__("New template","uipress-lite"),recentTemplates:__("Recent templates","uipress-lite"),templateName:__("Template name","uipress-lite"),active:__("Active","uipress-lite"),draft:__("Draft","uipress-lite"),recenter:__("Re-center","uipress-lite"),showGridLines:__("Show grid lines","uipress-lite"),frame:__("frame","uipress-lite"),zoom100:__("Zoom to 100%","uipress-lite")}},previewOptions:[{value:"builder",label:__("Builder","uipress-lite")},{value:"preview",label:__("Preview","uipress-lite")}]}},provide(){return{saveTemplate:this.saveCleanTemplate}},watch:{"ui.viewDevice":{handler(e,i){let t=this;if("desktop"==e){t.uiTemplate.windowWidth="1000";let e=document.getElementById("uip-preview-content");e&&(e.classList.add("uip-desktop-view"),e.classList.remove("uip-tablet-view"),e.classList.remove("uip-phone-view"))}if("tablet"==e){t.uiTemplate.windowWidth="699";let e=document.getElementById("uip-preview-content");e&&(e.classList.add("uip-tablet-view"),e.classList.remove("uip-desktop-view"),e.classList.remove("uip-phone-view"))}if("phone"==e){t.uiTemplate.windowWidth="600";let e=document.getElementById("uip-preview-content");e&&(e.classList.add("uip-phone-view"),e.classList.remove("uip-tablet-view"),e.classList.remove("uip-desktop-view"))}let s=new CustomEvent("uip_builder_preview_change",{detail:{windowWidth:t.uiTemplate.windowWidth}});document.dispatchEvent(s),requestAnimationFrame(()=>{this.scrollToPreview()})},deep:!0},"uiTemplate.content":{handler(e,i){let t=this;0!=i.length&&(this.unsavedChanges=!0),setTimeout(function(){t.manageBlockPositions()},400)},deep:!0},"uipData.templateDarkMode":{handler(e,i){let t="light";e&&(t="dark");let s=document.getElementsByClassName("uip-page-content-frame");s[0]&&s[0].contentWindow.document.documentElement.setAttribute("data-theme",t)},deep:!0},"uipData.userPrefs.darkTheme":{handler(e,i){"prod"!=this.uiTemplate.display&&(this.uipData.templateDarkMode=e)},deep:!0},"ui.zoom":{handler(e,i){let t=this,s=Math.round(10*e)/10;t.uipress.saveUserPreference("builderPrefersZoom",String(s),!1),t.isScrolling=!0,setTimeout(function(){requestAnimationFrame(()=>{t.isScrolling=!1,t.manageBlockPositions()})},300)},deep:!0},"uiTemplate.isPreview":{handler(e,i){this.manageBlockPositions()},deep:!0},"uipData.userPrefs.builderPrefersZoom":{handler(e,i){this.ui.zoom=this.uipData.userPrefs.builderPrefersZoom},deep:!0},"$route.params.templateID":{handler(){this.templateID=this.$route.params.templateID}},"$route.params.uid":{handler(){this.activeBlockID=this.$route.params.uid,this.buildDomObjects()}}},created:function(){this.setTheme()},mounted:function(){let e=this;e.uipress.saveTemplate=this.saveCleanTemplate;let i=parseFloat(this.uipData.userPrefs.builderPrefersZoom);i&&void 0!==i&&(this.ui.zoom=i);let t=navigator.platform.toUpperCase().indexOf("MAC")>=0,s=!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i),n=!!navigator.platform.match(/(iPhone|iPod|iPad)/i);(t||s||n)&&document.body.classList.add("macos"),window.addEventListener("keydown",function(i){"-"===i.key&&(i.metaKey||i.ctrlKey)&&(i.preventDefault(),e.zoomOut()),"+"!==i.key&&"Equal"!=i.code||!i.metaKey&&!i.ctrlKey||(i.preventDefault(),e.zoomIn()),"0"===i.key&&(i.metaKey||i.ctrlKey)&&(i.preventDefault(),e.ui.zoom=1,e.uipData.userPrefs.builderPrefersZoom=1)}),requestAnimationFrame(()=>{this.loading=!1,this.firstRender=!0,this.activeBlockID=this.$route.params.uid,this.$nextTick(()=>{this.scrollToPreview()})}),this.addDragListeners();let r=document.getElementById("uip-preview-canvas");if(r){new MutationObserver(()=>{e.manageBlockPositions}).observe(r,{attributes:!0,childList:!1,subtree:!1})}},computed:{returnDomObjects(){return this.loading&&this.firstRender?[]:this.domBlocks},returnHumanZoom(){return parseInt(100*this.ui.zoom)+"%"},getPreviewScale(){return`transform: scale( ${this.ui.zoom} );`},returnActiveBlockUID(){return this.activeBlockID},returnAllUiTemplates(){let e=this;if(!(e.allUiTemplates.length<1))return this.allUiTemplates;{let i=new FormData;i.append("action","uip_get_ui_templates"),i.append("security",uip_ajax.security),i.append("page",1),i.append("search",""),e.uipress.callServer(uip_ajax.ajax_url,i).then(e=>(this.allUiTemplates=e.templates,this.allUiTemplates))}},returnLayout(){return this.uiTemplate.layout},returnTemplateJS(){if(void 0!==this.uiTemplate.globalSettings.options)return"advanced"in this.uiTemplate.globalSettings.options&&"js"in this.uiTemplate.globalSettings.options.advanced?this.uiTemplate.globalSettings.options.advanced.js:void 0},returnTemplateCSS(){if(void 0!==this.uiTemplate.globalSettings.options)return"advanced"in this.uiTemplate.globalSettings.options&&"css"in this.uiTemplate.globalSettings.options.advanced?this.uiTemplate.globalSettings.options.advanced.css:void 0},returnCanvasWidth(){let e=2e3;return"tablet"==this.ui.viewDevice&&(e=990),"phone"==this.ui.viewDevice&&(e=700),"width:"+parseFloat(e*this.ui.zoom)+"px;"},returnCanvasWidthMax(){let e=2e3;return"tablet"==this.ui.viewDevice&&(e=990),"phone"==this.ui.viewDevice&&(e=700),"min-width:"+parseFloat(e*this.ui.zoom)+"px;"},getBlockFrames(){return this.blockFrames=[],this.uipress.findBYmodnameAndReturn(this.uiTemplate.content,["uip-dropdown","uip-block-modal","uip-slide-out","uip-accordion"],this.blockFrames),this.blockFrames}},methods:{returnFrameWidth(e){let i=document.getElementById("block-frame-"+e);if(!i)return;let t=i.getBoundingClientRect().width;return 300==t?"width:"+parseFloat(t)+"px;":"width:"+parseFloat(t*this.ui.zoom)+"px;"},addDragListeners(){let e={top:0,left:0,x:0,y:0},i=document.getElementById("uip-preview-canvas"),t=(document.getElementById("uip-frame-wrap"),document.getElementsByClassName("uip-block-canvas"));const s=function(t){const s=t.clientX-e.x,n=t.clientY-e.y;i.scrollTop=e.top-n,i.scrollLeft=e.left-s},n=function(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",n),i.style.cursor="default",i.style.removeProperty("user-select")};i.addEventListener("mousedown",function(r){if(2!=r.button){for(let e of t)if(e.contains(r.target))return;i.style.cursor="grabbing",i.style.userSelect="none",e={left:i.scrollLeft,top:i.scrollTop,x:r.clientX,y:r.clientY},document.addEventListener("mousemove",s),document.addEventListener("mouseup",n)}})},scrollToPreview(){let e=this;document.getElementById("uip-preview-content").scrollIntoView({behavior:"instant",block:"center",inline:"center"}),document.getElementById("uip-frame-wrap").scrollIntoView({behavior:"instant",block:"nearest",inline:"center"}),requestAnimationFrame(()=>{setTimeout(function(){e.buildDomObjects()},200)})},returnColorMode(){return this.uipData.userPrefs.darkTheme?"dark":this.uipData.templateDarkMode?"dark":"light"},saveTemplate(){let e=this;e.saving=!0;let i=JSON.parse(JSON.stringify(e.uiTemplate.content));this.uipress.cleanTemplate(i).then(t=>{e.saveCleanTemplate(i)})},async saveCleanTemplate(e){let i=this,t={};t.globalSettings=JSON.parse(JSON.stringify(i.uiTemplate.globalSettings)),t.content=e;let s=JSON.stringify(t,(e,i)=>"true"===i?"uiptrue":!0===i?"uiptrue":"false"===i?"uipfalse":!1===i?"uipfalse":""===i?"uipblank":i),n=this.formatStyles(),r=JSON.stringify(n,(e,i)=>"true"===i?"uiptrue":!0===i?"uiptrue":"false"===i?"uipfalse":!1===i?"uipfalse":""===i?"uipblank":i),l=new FormData;return l.append("action","uip_save_ui_template"),l.append("security",uip_ajax.security),l.append("templateID",i.templateID),l.append("template",s),l.append("styles",r),await i.uipress.callServer(uip_ajax.ajax_url,l).then(e=>{if(e.error)return i.uipress.notify(e.message,"uipress-lite","","error",!0),i.saving=!1,!1;if(e.success){i.uipress.notify(__("Template saved","uipress-lite"),"","success",!0),i.unsavedChanges=!1,i.saving=!1;let e=JSON.parse(JSON.stringify(i.uiTemplate.content));return i.uipress.logHistoryChange(__("Template saved","uipress-lite"),e,e),!0}})},formatStyles(){let e=this.uipData.themeStyles,i={};for(let t in e)e[t].value&&(i[e[t].name]||(i[e[t].name]={}),i[e[t].name].value=e[t].value),e[t].darkValue&&(i[e[t].name]||(i[e[t].name]={}),i[e[t].name].darkValue=e[t].darkValue),e[t].user&&(i[e[t].name].user=e[t].user,i[e[t].name].label=e[t].label,i[e[t].name].name=e[t].name,i[e[t].name].type=e[t].type);return i},goBackToList(){this.unsavedChanges?this.uipress.confirm(__("You have unsaved changes!","uipress-lite"),__("If you leave this page all unsaved changes will be discarded","uipress-lite")).then(e=>{e&&this.router.push("/")}):this.router.push("/")},returnLoadStyle(){if(this.saving)return"opacity:0;"},toggleLayers(){this.layersPanel.display=!this.layersPanel.display,this.uipress.saveUserPreference("builderLayers",this.layersPanel.display,!1)},toggleDisplay(){"preview"==this.uiTemplate.display?this.uiTemplate.display="builder":this.uiTemplate.display="preview"},preTemplateExport(){let e=this,i=e.uipress.notify(__("Exporting layout","uipress-lite"),"","default",!1,!0);e.uipress.cleanTemplate(e.uiTemplate.content).then(t=>{e.exportLayout(i)})},exportLayout(e){self=this;let i=JSON.stringify(self.uiTemplate.content),t=self.uiTemplate.globalSettings.name,s=new Date,n=String(s.getDate()).padStart(2,"0"),r="uip-ui-template-"+t+"-"+(String(s.getMonth()+1).padStart(2,"0")+"-"+n+"-"+s.getFullYear())+".json",l="data:text/json;charset=utf-8,"+encodeURIComponent(i),a=document.getElementById("uip-export-layout");a.setAttribute("href",l),a.setAttribute("download",r),a.click(),self.uipress.notify(__("Layout exported","uipress-lite"),"","success",!0),self.uipress.destroy_notification(e)},importSettings(){let e=this,i=e.uipress.notify(__("Importing layout","uipress-lite"),"","default",!1,!0),t=document.getElementById("uip-import-layout").files[0];if("application/json"!=t.type)return e.uipress.notify("Templates must be in valid JSON format","","error",!0,!1),void e.uipress.destroy_notification(i);if(t.size>1e6)return e.uipress.notify("Uploaded file is too big","","error",!0,!1),void e.uipress.destroy_notification(i);let s=new FileReader;s.readAsText(t,"UTF-8"),s.onload=function(t){let s,n=t.target.result;try{s=JSON.parse(n)}catch(t){return e.uipress.notify(t,"","error",!0,!1),void e.uipress.destroy_notification(i)}if(null!=s){if(!Array.isArray(s))return e.uipress.notify("Template is not valid","","error",!0,!1),void e.uipress.destroy_notification(i);e.uipress.validDateTemplate(s).then(t=>{t.includes(!1)?(e.uipress.notify("File is not a valid JSON template","","error",!0,!1),e.uipress.destroy_notification(i)):(e.uiTemplate.content=s,e.uipress.notify("Template imported","","success",!0,!1),e.uipress.destroy_notification(i))})}else e.uipress.notify("JSON parse failed","","error",!0,!1),e.uipress.destroy_notification(i)}},openThemeLibrary(){let e=this.$route.params.templateID;this.router.push("/uibuilder/"+e+"/library")},switchLayout(e){let i=this;this.unsavedChanges?this.uipress.confirm(__("You have unsaved changes!","uipress-lite"),__("If you leave this page all unsaved changes will be discarded","uipress-lite")).then(t=>{t&&(i.router.push("/uibuilder/"+e+"/"),i.unsavedChanges=!1)}):i.router.push("/uibuilder/"+e+"/")},confirmNewPage(e){let i=this;this.unsavedChanges?this.uipress.confirm(__("You have unsaved changes!","uipress-lite"),__("If you leave this page all unsaved changes will be discarded","uipress-lite")).then(e=>{e&&i.createNewUI()}):i.createNewUI()},createNewUI(){let e=this,i=new FormData;i.append("action","uip_create_new_ui_template"),i.append("security",uip_ajax.security),i.append("templateType","ui-template"),e.uipress.callServer(uip_ajax.ajax_url,i).then(i=>{e.uipress.notify("New template created","","success",!0,!1),e.router.push("/"),e.router.push("/uibuilder/"+i.id+"/"),e.returnAllUiTemplates})},clickHandler(e){let i=e.target.closest("[block-uid]");if(!i)return;let t=i.getAttribute("block-uid");t&&this.openBlockSettings(t)},openBlockSettings(e){let i=this.$route.params.templateID;this.router.push({path:"/uibuilder/"+i+"/settings/blocks/"+e,query:{...this.$route.query}})},zoomOut(){this.ui.zoom-=.1,this.uipData.userPrefs.builderPrefersZoom=this.ui.zoom},zoomIn(){this.ui.zoom+=.1,this.uipData.userPrefs.builderPrefersZoom=this.ui.zoom},returnThemeIcon(){return this.uipData.userPrefs.darkTheme?"light_mode":"dark_mode"},addWidthWatchers(e){let i=this;const t=new ResizeObserver(t=>{t.forEach(t=>{if(i.resizer.resizing||i.isScrolling)return;let s=document.getElementById("block-frame-title-"+e);s&&(s.style.width=t.target.getBoundingClientRect().width+"px"),this.manageBlockPositions()})});let s=document.getElementById("block-frame-"+e);s&&t.observe(s)},buildDomObjects(){for(let e of this.domBlocks)"observer"in e&&e.observer.disconnect();this.domBlocks=[];let e=this.$route.params.uid;if(!e)return this.domBlocks=[],this.domBlocks;let i=document.querySelectorAll(`#uip-preview-canvas [block-uid='${e}']`);if(!i)return this.domBlocks=[],this.domBlocks;if(0===i.length)return this.domBlocks;for(let t of i){if(t.closest('[uip-block-query="true"]'))continue;let i=new IntersectionObserver(this.manageBlockPositions);i.observe(t,{attributes:!0,childList:!1,subtree:!1});let s=t.getBoundingClientRect();this.domBlocks.push({dom:t,uid:e,left:s.left,top:s.top,width:s.width,height:s.height,observer:i})}return this.domBlocks},manageBlockPositions(){if(!this.resizer.resizing)for(let e of this.domBlocks){let i=e.dom.getBoundingClientRect();i.left==e.left&&i.top==e.top&&i.width==e.width&&i.height==e.height||this.buildDomObjects()}},handleScroll(e){this.$refs.previewCanvas;clearTimeout(this.scrollDebounce),this.isScrolling=!0,this.scrollDebounce=setTimeout(()=>{this.isScrolling=!1,this.manageBlockPositions()},150)},setSelectedWrapPos(e){if(e){let i="";return i+=`width:${e.width}px;`,i+=`height:${e.height}px;`,i+=`left:${e.left}px;`,i+=`top:${e.top}px;`,i+="pointer-events: none;"}},initResizeBlock(e,i,t){e.preventDefault(),this.resizer.startX=e.clientX,this.resizer.startY=e.clientY;let s=e.target.parentNode;this.resizer.resizing=!0,this.resizer.wrap=s,this.resizer.width=this.resizer.wrap.getBoundingClientRect().width,this.resizer.height=this.resizer.wrap.getBoundingClientRect().height,this.resizer.uid=i.uid,this.resizer.type=t,this.resizer.originalSize=this.resizer.wrap.getBoundingClientRect(),this.resizer.domItem=i.dom,this.uipress.searchForBlock(this.uiTemplate.content,this.resizer.uid).then(e=>{this.resizer.block=e;let i=this.uipress.checkNestedValue(this.resizer.block,["settings","style","options","dimensions","value","width","value"]);if(i&&" "!=i)this.resizer.blockWidth=i,this.resizer.previewBlockWidth=i;else{let e=this.resizer.wrap.getBoundingClientRect().width/this.ui.zoom*1;e=e.toFixed(0),this.resizer.blockWidth=e,this.resizer.previewBlockWidth=e}let t=this.uipress.checkNestedValue(this.resizer.block,["settings","style","options","dimensions","value","height","value"]);if(t&&" "!=t)this.resizer.blockHeight=t,this.resizer.previewBlockHeight=t;else{let e=this.resizer.wrap.getBoundingClientRect().height/this.ui.zoom*1;e=e.toFixed(0),this.resizer.blockHeight=e,this.resizer.previewBlockHeight=e}}),this.resizer.wrap.classList.add("uip-block-resizing"),document.addEventListener("mousemove",this.resizeBlock),document.addEventListener("mouseup",this.stopResizeBlock)},resizeBlock(e){if(e.preventDefault(),!this.resizer.resizing)return;const i=e.clientX-this.resizer.startX,t=e.clientY-this.resizer.startY;let s=this.domBlocks.find(e=>e.uid===this.resizer.uid);if(this.$refs.resizingdigits)for(let i of this.$refs.resizingdigits)"left"==this.resizer.type||"left-top"==this.resizer.type?(i.style.left=e.clientX-60+"px",i.style.top=e.clientY-10+"px"):(i.style.left=e.clientX+20+"px",i.style.top=e.clientY-10+"px");if(0!==i)if("left"==this.resizer.type||"left-top"==this.resizer.type){s.width=this.resizer.width-i;let e=parseInt(this.resizer.blockWidth)-parseInt(i/this.ui.zoom*1);this.resizer.previewBlockWidth=parseInt(e),s.left=this.resizer.originalSize.left+i}else{s.width=this.resizer.width+i;let e=parseInt(this.resizer.blockWidth)+parseInt(i/this.ui.zoom*1);this.resizer.previewBlockWidth=parseInt(e)}if(0!==t)if("top"==this.resizer.type||"left-top"==this.resizer.type){s.height=this.resizer.height-t;let e=parseInt(this.resizer.blockHeight)-parseInt(t/this.ui.zoom*1);this.resizer.previewBlockHeight=parseInt(e),s.top=this.resizer.originalSize.top+t}else{s.height=this.resizer.height+t;let e=parseInt(this.resizer.blockHeight)+parseInt(t/this.ui.zoom*1);this.resizer.previewBlockHeight=parseInt(e)}},stopResizeBlock(){this.resizer.wrap.classList.remove("uip-block-resizing"),this.resizer.resizing=!1;let e=this.resizer.wrap.getBoundingClientRect().width,i=e/this.resizer.width;if(0!=i){let t=this.uipress.checkNestedValue(this.resizer.block,["settings","style","options","dimensions","value","width","value"]),s=this.uipress.checkNestedValue(this.resizer.block,["settings","style","options","dimensions","value","width","units"]);if(t&&s){let e=(t*i).toFixed(0);this.resizer.block.settings.style.options.dimensions.value.width.value=e}if(!t||" "==t){this.uipress.createNestedObject(this.resizer.block,["settings","style","options","dimensions","value","width","value"]),this.uipress.createNestedObject(this.resizer.block,["settings","style","options","dimensions","value","width","units"]);let i=e/this.ui.zoom*1;i=i.toFixed(0),this.resizer.block.settings.style.options.dimensions.value.width.value=i,this.resizer.block.settings.style.options.dimensions.value.width.units="px"}}let t=this.resizer.wrap.getBoundingClientRect().height,s=t/this.resizer.height;if(0!=s){let e=this.uipress.checkNestedValue(this.resizer.block,["settings","style","options","dimensions","value","height","value"]),i=this.uipress.checkNestedValue(this.resizer.block,["settings","style","options","dimensions","value","height","units"]);if(e&&i){let i=(e*s).toFixed(0);this.resizer.block.settings.style.options.dimensions.value.height.value=i}if(!e||" "==e){this.uipress.createNestedObject(this.resizer.block,["settings","style","options","dimensions","value","height","value"]),this.uipress.createNestedObject(this.resizer.block,["settings","style","options","dimensions","value","height","units"]);let e=t/this.ui.zoom*1;e=e.toFixed(0),this.resizer.block.settings.style.options.dimensions.value.height.value=e,this.resizer.block.settings.style.options.dimensions.value.height.units="px"}}requestAnimationFrame(()=>{this.buildDomObjects()}),document.removeEventListener("mousemove",this.resizeBlock),document.removeEventListener("mouseup",this.stopResizeBlock)},returnContentDropStyles(e){let i=this.uipress.checkNestedValue(e,["settings","contentStyle","options"]);if(!i)return;let t=this.uipress.explodeSpecificBlockSettings(i,"style",this.uipData.templateDarkMode,null,"flexLayout");return void 0===t?"":(t.includes("display:grid;")?this.forceFlex=!0:this.forceFlex=!1,t)},toggleDarkMode(){this.uipData.userPrefs.darkTheme=!this.uipData.userPrefs.darkTheme,this.setTheme(),this.uipress.saveUserPreference("darkTheme",this.uipData.userPrefs.darkTheme,!1)},setTheme(){let e="light";this.uipData.userPrefs.darkTheme?(e="dark",this.uipData.userPrefs.darkTheme=!0):this.uipData.userPrefs.darkTheme=!1,document.getElementsByTagName("html")[0].setAttribute("data-theme",e);let i=document.getElementsByClassName("uip-page-content-frame");if(i[0])for(const t of i)t.contentWindow.document.documentElement.setAttribute("data-theme",e)}},template:'\n      <component is="style" scoped >\n        .uip-user-frame[data-theme="light"]:not(.uip-app-frame){\n        <template v-for="item in uipData.themeStyles">\n           <template v-if="item.value">{{item.name}}:{{item.value}};</template>\n        </template>\n        }\n        .uip-user-frame[data-theme="dark"]:not(.uip-app-frame) *{\n        <template v-for="item in uipData.themeStyles">\n           <template v-if="item.darkValue"> {{item.name}}:{{item.darkValue}};</template>\n        </template>\n        }\n        {{returnTemplateCSS}}\n      </component>\n      <component is="script" scoped >\n        {{returnTemplateJS}}\n      </component>\n\n      \n      \n      <div ref="previewcontainer" class="uip-h-100p uip-w-100p uip-flex uip-flex-column uip-max-h-100p uip-overflow-hidden">\n        \n        \x3c!--preview area --\x3e\n        \n        <div id="uip-preview-canvas" ref="previewCanvas" class="uip-flex-grow uip-flex-grow uip-flex-middle uip-hide-scrollbar uip-overflow-auto uip-max-w-100p uip-max-h-100p uip-w-100p uip-border-box"\n        v-on:scroll.native="handleScroll($event)">\n        \n            <div id="uip-ui-preview-area" class="uip-user-frame uip-padding-m uip-flex uip-flex-center uip-flex-middle" style="width:20000px;height:20000px" :data-theme="returnColorMode()">\n              \n              <div ref="framewrap" class="uip-flex uip-gap-m uip-flex-start uip-w-auto" id="uip-frame-wrap">\n                \n                \x3c!--Primary template --\x3e\n                <div class="uip-row-gap-s uip-flex uip-flex-column ">\n                \n                 \n                  <div class="uip-background-muted uip-border uip-w-100p uip-padding-xxs uip-padding-left-xs uip-flex uip-gap-xs uip-flex-center" \n                  style="border-radius: calc( var(--uip-border-radius) + var(--uip-padding-xxs) );"\n                  :style="returnCanvasWidthMax" :class="uiTemplate.isPreview ? \'uip-opacity-0\' : \'\'">\n                  \n                    <div class="uip-text-muted uip-text-bold uip-flex-grow">{{uiTemplate.globalSettings.name}}</div>\n                    \n                    \x3c!--Device switcher--\x3e\n                    \n                    <drop-down dropPos="bottom-right" :relative="true" slotClass="uip-padding-xs">\n                    \n                      <template v-slot:trigger>\n                  \n                        <div class="uip-padding-left-xs uip-padding-right-xs uip-border-rounder uip-flex uip-gap-xs uip-flex-between uip-link-default uip-flex-center" style=""  \n                        @click="deviceSwitcherOpen = !deviceSwitcherOpen">\n                            <div class="">\n                              <template v-if="ui.viewDevice == \'desktop\'">{{ui.strings.desktop}}</template>\n                              <template v-if="ui.viewDevice == \'tablet\'">{{ui.strings.tablet}}</template>\n                              <template v-if="ui.viewDevice == \'phone\'">{{ui.strings.mobile}}</template>\n                            </div>\n                            <div class="uip-icon uip-text-l">expand_more</div>\n                        </div>\n                    \n                      </template>\n                      \n                      <template v-slot:content>\n                      \n                        <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-gap-l uip-flex-between uip-link-default" \n                        @click="ui.viewDevice = \'desktop\';deviceSwitcherOpen = false;">\n                          \n                          <div class="">{{ui.strings.desktop}}</div>\n                          <div class="uip-flex uip-flex-center uip-text-muted uip-gap-xxxs">\n                            <span class="uip-icon" style="line-height:0">desktop_windows</span>\n                          </div>\n                          \n                        </div> \n                        \n                        <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-gap-l uip-flex-between uip-link-default" \n                        @click="ui.viewDevice = \'tablet\';deviceSwitcherOpen = false;">\n                          \n                          <div class="">{{ui.strings.tablet}}</div>\n                          <div class="uip-flex uip-flex-center uip-text-muted uip-gap-xxxs">\n                            <span class="uip-icon">tablet_mac</span>\n                          </div>\n                          \n                        </div> \n                        \n                        \n                        <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-gap-l uip-flex-between uip-link-default" \n                        @click="ui.viewDevice = \'phone\';deviceSwitcherOpen = false">\n                          \n                          <div class="">{{ui.strings.mobile}}</div>\n                          <div class="uip-flex uip-flex-center uip-text-muted uip-gap-xxxs">\n                            <span class="uip-icon">smartphone</span>\n                          </div>\n                          \n                        </div> \n                      \n                      </template>\n                      \n                    </drop-down>\n                        \n                    \n                  </div>\n                \n                  <div class="uip-position-relative" :class="uiTemplate.globalSettings.type">\n                    <div id="uip-preview-content" class="uip-flex uip-flex-column uip-text-normal uip-desktop-view uip-position-relative uip-block-canvas uip-position-absolute" style="width:2000px;transform-origin: 0% 0%;transform:scale(1)"  :style="getPreviewScale">\n                      \n                      \x3c!--PAGE BODY--\x3e\n                      <div ref="templatebody" id="uip-template-body" class="uip-flex uip-flex-grow uip-text-normal uip-body-font uip-background-default uip-border-round uip-border"\n                      @click="clickHandler($event)" >\n                    \n                          \x3c!--MAIN DROP AREA--\x3e\n                          <uip-content-area :content="uiTemplate.content" :returnData="function(data) {uiTemplate.content = data}"></uip-content-area>\n                          \x3c!--END OF MAIN DROP AREA--\x3e\n                        \n                      </div>\n                    </div>\n                  </div>\n                  \n                \n                </div>\n                \x3c!--End primary template--\x3e\n                \n                \x3c!--Output frames--\x3e\n                \n                <template v-for="block in getBlockFrames">\n                \n                  <div class="uip-row-gap-s uip-flex uip-flex-column" :id="\'block-frame-wrap-\' + block.uid" :class="uiTemplate.isPreview ? \'uip-opacity-0\' : \'\'">\n                  \n                  \n                    <div class="uip-background-muted uip-border uip-w-100p uip-padding-xxs uip-flex uip-gap-xs uip-flex-center uip-link-muted" \n                    :id="\'block-frame-title-\' + block.uid"\n                    style="border-radius: calc( var(--uip-border-radius) + var(--uip-padding-xxs) );"  \n                    @click="openBlockSettings(block.uid)">\n                    \n                      <div :title="ui.strings.preview" class="uip-icon uip-text-l uip-border-rounder" style="">crop_free</div>\n                      <div class="uip-text-muted uip-text-bold uip-flex-grow uip-no-wrap uip-overflow-hidden uip-text-ellipsis">{{block.name}} {{ui.strings.frame}}</div>\n                      \n                    </div>\n                    \n                    \n                    \x3c!--Frame content--\x3e\n                    <div class="uip-position-relative">\n                      <div class="uip-position-relative uip-frame-content uip-position-absolute">\n                      \n                        <div class="uip-text-normal uip-body-font uip-background-default uip-border-round uip-border uip-min-h-300 uip-min-w-200 uip-overflow-visible uip-block-canvas uip-flex" \n                        :id="\'block-frame-\' + block.uid"\n                        :style="\'transform: scale( \' + ui.zoom + \');transform-origin: 0% 0%;\'">\n                          <div class="uip-flex-grow uip-h-100p uip-overflow-visible uip-flex-no-shrink" @click="clickHandler($event)" \n                          :class="returnActiveBlockUID == block.uid ? \'uip-preview-selected-block\' : \'\'"\n                          :block-uid="block.uid">\n                            \x3c!--BLOCK MAIN DROP AREA--\x3e\n                            <uip-content-area :content="block.content" :returnData="function(data) {block.content = data}" :dropAreaStyle="returnContentDropStyles(block)"></uip-content-area>\n                            \x3c!--END OF MAIN DROP AREA--\x3e\n                          </div>\n                          \n                        </div>\n                      \n                      </div>\n                    </div>\n                    \n                   {{addWidthWatchers(block.uid)}}\n                    \n                  </div>  \n                \n                </template>\n                \n                \x3c!--Endframes--\x3e\n              \n              </div>\n              \n            </div>\n          \n          \n        </div>\n        \x3c!--end of preview area --\x3e\n        \n        \n        <div class="uip-position-fixed uip-bottom-0 uip-left-50p uip-translateX--50p uip-z-index-1" style="bottom:32px">\n          \n          \n          \n            <div class="uip-flex uip-flex-center uip-padding-xs uip-background-default uip-border-rounder uip-shadow uip-border">\n            \n                \n                <drop-down dropPos="top-left" :dontAnimate="true" :relative="true">\n                  \n                  <template v-slot:trigger>\n                \n                    <div class="uip-background-muted uip-padding-xxs uip-border-rounder uip-flex uip-gap-s uip-flex-between uip-link-default uip-flex-center">\n                        <div class="">{{returnHumanZoom}}</div>\n                        <div class="uip-icon uip-text-l">expand_less</div>\n                    </div>\n                  \n                  </template>\n                  \n                  <template v-slot:content>\n                    <div class="uip-padding-xs uip-flex uip-flex-column uip-text-s">\n                      \n                      <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-gap-l uip-flex-between uip-link-default" @click="zoomOut()">\n                        \n                        <div class="uip-no-wrap">{{ui.strings.zoomOut}}</div>\n                        <div class="uip-flex uip-flex-center uip-text-muted uip-gap-xxxs">\n                          \n                          <span class="uip-command-icon"></span>\n                          <span class="uip-icon" style="line-height:0">remove</span>\n                          \n                        </div>\n                        \n                      </div> \n                      \n                      <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-gap-l uip-flex-between uip-link-default" @click="zoomIn()">\n                        \n                        <div class="uip-no-wrap">{{ui.strings.zoomIn}}</div>\n                        <div class="uip-flex uip-flex-center uip-text-muted uip-gap-xxxs">\n                        \n                          <span class="uip-command-icon"></span>\n                          <span class="uip-icon" style="line-height:0">add</span>\n                          \n                        </div>\n                        \n                      </div> \n                      \n                      \n                      <div class="uip-flex uip-flex-row uip-flex-center uip-gap-xs uip-padding-xxs hover:uip-background-muted uip-border-rounder uip-gap-l uip-flex-between uip-link-default" @click="ui.zoom = 1">\n                        \n                        <div class="uip-no-wrap">{{ui.strings.zoom100}}</div>\n                        <div class="uip-flex uip-flex-center uip-text-muted uip-gap-xxxs">\n                        \n                          <span class="uip-command-icon"></span>\n                          <span class="uip-icon" style="line-height:0">exposure_zero</span>\n                          \n                        </div>\n                        \n                      </div> \n                      \n                      \n                      \n                    </div>\n                  </template>\n                \n                </drop-down>\n                \n                <div class=" uip-margin-left-xs uip-margin-right-xs uip-h-20"></div>\n                \n                \n                \n                \n               \n                \n                <div :title="ui.strings.recenter" class="hover:uip-background-muted uip-padding-xxxs uip-border-round uip-flex uip-flex-center  uip-icon uip-link-default uip-text-xl uip-ratio-1-1 uip-line-height-1 uip-icon-medium" @click="scrollToPreview()">\n                center_focus_strong\n                </div>\n                \n                <div :title="ui.strings.showGridLines" class="hover:uip-background-muted uip-padding-xxxs uip-border-round uip-flex uip-flex-center  uip-icon uip-link-default uip-text-xl uip-ratio-1-1 uip-line-height-1 uip-icon-medium" @click="toggleDisplay()" :class="{\'uip-background-grey uip-text-emphasis\' : uiTemplate.display != \'preview\'}">\n                grid_3x3\n                </div>\n                \n                \x3c!-- Dark mode --\x3e\n                <div :title="ui.strings.darkMode" class="hover:uip-background-muted uip-padding-xxxs uip-border-round uip-flex uip-flex-center  uip-icon uip-link-default uip-text-xl uip-ratio-1-1 uip-line-height-1 uip-icon-medium" @click="toggleDarkMode()">\n                {{returnThemeIcon()}}\n                </div>\n                \n                \n                  \n                \n                \n                \n              \n            </div>\n          \n        </div>\n        \n        \n        \n        \x3c!-- End right click --\x3e\n      </div>\n      \n      \n      <div v-if="returnDomObjects.length > 0 && resizer.resizing" class="uip-position-fixed uip-top-0 uip-left-0 uip-right-0 uip-bottom-0"></div>\n            \n      <template v-for="item in returnDomObjects">\n        <div v-show="!isScrolling && !uiTemplate.isPreview" class="uip-position-fixed uip-w-200 uip-ratio-1-1 uip-fade-in uip-block-wrap uip-block-selected-wrap" :style="setSelectedWrapPos(item)">\n        \n            <div class="uip-border-blue uip-background-default uip-w-8 uip-ratio-1-1 uip-border-circle uip-position-absolute uip-left-0 uip-top-0" \n            style="transform: translateY(-50%) translateX(-50%);cursor: nwse-resize;pointer-events: all;"\n            @mousedown.prevent="initResizeBlock($event, item, \'left-top\')"></div>\n            \n            <div class="uip-border-blue uip-background-default uip-w-8 uip-ratio-1-1 uip-border-circle uip-position-absolute uip-right-0 uip-top-0" \n            style="transform: translateY(-50%) translateX(50%);cursor: nesw-resize;pointer-events: all;"\n            @mousedown.prevent="initResizeBlock($event, item, \'top\')"></div>\n            \n            <div class="uip-border-blue uip-background-default uip-w-8 uip-ratio-1-1 uip-border-circle uip-position-absolute uip-left-0 uip-bottom-0" \n            style="transform: translateY(50%) translateX(-50%);cursor: nesw-resize;pointer-events: all;"\n            @mousedown.prevent="initResizeBlock($event, item, \'left\')"></div>\n            \n            <div class="uip-border-blue uip-background-default uip-w-8 uip-ratio-1-1 uip-border-circle uip-position-absolute uip-right-0 uip-bottom-0" \n            style="transform: translateY(50%) translateX(50%);cursor: nwse-resize;pointer-events: all;"\n            @mousedown.prevent="initResizeBlock($event, item)"></div>\n            \n            <div v-show="resizer.resizing" ref="resizingdigits" class="uip-border-rounder uip-position-fixed uip-padding-xxs uip-text-xs uip-text-inverse" \n            style="background:rgba(1,1,1,0.6)">{{resizer.previewBlockWidth}} x {{resizer.previewBlockHeight}}</div>\n            \n        </div>\n      </template>\n      \n      \n      '}};