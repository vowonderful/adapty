const{__:__,_x:_x,_n:_n,_nx:_nx}=wp.i18n;export function moduleData(){return{props:{},data:function(){return{ui:{dynamicData:{display:!1,index:0,top:0,right:0,input:!1,search:"",inlineSearch:"",cursorPosition:0}},strings:{dynamicData:__("Dynamic data","uipress-lite"),searchData:__("Search","uipress-lite")},dynamicCategories:[{name:"query",label:__("Query","uipress-lite"),icon:"all_inclusive"},{name:"array",label:__("Array","uipress-lite"),icon:"data_array"},{name:"image",label:__("Image","uipress-lite"),icon:"image"},{name:"link",label:__("Link","uipress-lite"),icon:"link"},{name:"text",label:__("Text","uipress-lite"),icon:"title"}],dynamicOptions:[{name:"post_title",label:__("Post title","uipress-lite"),type:"query"},{name:"post_author",label:__("Post author","uipress-lite"),type:"query"},{name:"post_date",label:__("Post date","uipress-lite"),type:"query"},{name:"post_link",label:__("Post link","uipress-lite"),type:"query"},{name:"post_edit_link",label:__("Post edit link","uipress-lite"),type:"query"},{name:"post_featured_image",label:__("Post featured image","uipress-lite"),type:"query"},{name:"post_content",label:__("Post content","uipress-lite"),type:"query"},{name:"post_excerpt",label:__("Post excerpt","uipress-lite"),type:"query"},{name:"post_type",label:__("Post type","uipress-lite"),type:"query"},{name:"post_status",label:__("Post status","uipress-lite"),type:"query"},{name:"comment_count",label:__("Comment count","uipress-lite"),type:"query"},{name:"meta:key",label:__("Meta key","uipress-lite"),type:"query"},{name:"acf_meta:key",label:__("ACF Meta key","uipress-lite"),type:"query"},{name:"mb_meta:key",label:__("Metabox Meta key","uipress-lite"),type:"query"},{name:"attachment_image",label:__("Attachment image","uipress-lite"),type:"query"},{name:"post_mime_type",label:__("Attachment type","uipress-lite"),type:"query"},{name:"ID",label:__("User id","uipress-lite"),type:"query"},{name:"display_name",label:__("User display name","uipress-lite"),type:"query"},{name:"user_email",label:__("User email","uipress-lite"),type:"query"},{name:"user_login",label:__("User login","uipress-lite"),type:"query"},{name:"user_nicename",label:__("User nicename","uipress-lite"),type:"query"},{name:"user_registered",label:__("User registered","uipress-lite"),type:"query"},{name:"user_avatar",label:__("User profile image","uipress-lite"),type:"query"},{name:"meta:key",label:__("User meta","uipress-lite"),type:"query"},{name:"acf_user_meta:key",label:__("ACF User meta","uipress-lite"),type:"query"}],multisiteOptions:[{name:"registered",label:__("Site registered","uipress-lite"),type:"query"},{name:"domain",label:__("Site domain","uipress-lite"),type:"query"},{name:"last_updated",label:__("Site last updated","uipress-lite"),type:"query"},{name:"path",label:__("Site path","uipress-lite"),type:"query"},{name:"blog_id",label:__("Site id","uipress-lite"),type:"query"},{name:"site_name",label:__("Site name","uipress-lite"),type:"query"},{name:"site_home_url",label:__("Site home url","uipress-lite"),type:"query"},{name:"site_dashboard_url",label:__("Site admin url","uipress-lite"),type:"query"},{name:"meta:key",label:__("Site meta","uipress-lite"),type:"query"}]}},inject:["uipress","uiTemplate","uipData"],watch:{},mounted:function(){this.formatDynamicData(),this.mountWatcher()},computed:{dynamicOptionsWithSearch(){let e=[];for(let t of this.dynamicOptions)this.inSearch(t)&&e.push(t);return e},returndynamicDataMenuStyle(){return"top:"+this.ui.dynamicData.top+"; right:"+this.ui.dynamicData.right+";"}},methods:{formatDynamicData(){let e=Object.values(this.uipData.dynamicOptions);e=e.sort((e,t)=>e.type<t.type?-1:e.type>t.type?1:0),this.uipData.options.multisite&&(this.dynamicOptions=this.dynamicOptions.concat(this.multisiteOptions)),this.dynamicOptions=this.dynamicOptions.concat(e)},mountWatcher(){let e=this;e.mountDynamicSequence("{{",function(t,i){let a=window.innerWidth-t.x;e.ui.dynamicData.right=`${a}px`,e.ui.dynamicData.display=!0,e.ui.dynamicData.input=i,e.ui.dynamicData.search="",e.ui.dynamicData.cursorPosition=e.getCaretPosition(i),t.y+300>window.innerHeight?e.ui.dynamicData.top=t.y-280+"px":e.ui.dynamicData.top=`${t.y}px`,e.ui.dynamicData.closeEvent=e.mountDynamicSequence("}}",e.closeDynamicData),i.addEventListener("keypress",e.watchKeyInput),i.addEventListener("keydown",e.watchForclosure),document.addEventListener("click",e.watchForOutsideClick)})},mountDynamicSequence(e,t){const i=i=>this.handleInputEvent(i,e,t);return document.addEventListener("input",i),i},handleInputEvent(e,t,i){if("INPUT"===e.target.tagName||e.target.classList.contains("ql-editor")){const a=this.returnInputValue(e.target),n=this.getCaretPosition(e.target);let s=a.slice(n-t.length),u=s.slice(t.length);if(s.replace(u,"")===t){const t=e.target.getBoundingClientRect();i({x:t.left+n,y:t.top},e.target)}}},injectDynamicLabel(e){const t=this.ui.dynamicData.input;let i="{{";const a=`{{${e.name}}}`,n=this.ui.dynamicData.cursorPosition;this.ui.dynamicData.inlineSearch&&(i+=this.ui.dynamicData.inlineSearch);let s=this.returnInputValue(t);const u=this.returnInputValue(t).slice(0,n-i.length)+a+s.slice(n);"INPUT"===t.tagName?t.value=u:t.textContent=u,t.selectionStart=t.selectionEnd=n-i.length+a.length,t.dispatchEvent(new Event("input")),this.ui.dynamicData.display=!1,this.closeDynamicData()},watchKeyInput(e){e.preventDefault(),("INPUT"===e.target.tagName||e.target.classList.contains("ql-editor"))&&("Backspace"===e.key?(this.ui.dynamicData.search=this.ui.dynamicData.search.slice(0,-1),this.ui.dynamicData.inlineSearch=this.ui.dynamicData.inlineSearch.slice(0,-1)):"Escape"===e.key?this.closeDynamicData():"Enter"===e.key?this.dynamicOptionsWithSearch[this.ui.dynamicData.index]&&this.injectDynamicLabel(this.dynamicOptionsWithSearch[this.ui.dynamicData.index]):(this.ui.dynamicData.search+=e.key,this.ui.dynamicData.inlineSearch+=e.key),this.ui.dynamicData.cursorPosition=this.getCaretPosition(e.target))},watchForclosure(e){if("INPUT"===e.target.tagName||e.target.classList.contains("ql-editor")){if("Escape"===e.key&&this.closeDynamicData(),"Enter"===e.key&&this.dynamicOptionsWithSearch[this.ui.dynamicData.index])return void this.injectDynamicLabel(this.dynamicOptionsWithSearch[this.ui.dynamicData.index]);if("ArrowDown"===e.key){this.ui.dynamicData.index>=this.dynamicOptionsWithSearch.length-1?this.ui.dynamicData.index=0:this.ui.dynamicData.index+=1;let e=this.dynamicOptionsWithSearch[this.ui.dynamicData.index].name;document.querySelector(`#uip-dynamic-list #${e}`).scrollIntoView({behavior:"auto",block:"nearest",inline:"center"})}if("ArrowUp"===e.key){this.ui.dynamicData.index<=0?this.ui.dynamicData.index=this.dynamicOptionsWithSearch.length-1:this.ui.dynamicData.index-=1;let e=this.dynamicOptionsWithSearch[this.ui.dynamicData.index].name;document.querySelector(`#uip-dynamic-list #${e}`).scrollIntoView({behavior:"auto",block:"nearest",inline:"center"})}}},watchForOutsideClick(e){this.$refs.dynamicdatamenu||this.closeDynamicData(),this.$refs.dynamicdatamenu.contains(e.target)||this.closeDynamicData()},closeDynamicData(){this.ui.dynamicData.display=!1,this.ui.dynamicData.index=0,this.ui.dynamicData.search="",this.ui.dynamicData.inlineSearch="",document.removeEventListener("input",this.ui.dynamicData.closeEvent),this.ui.dynamicData.input.removeEventListener("keydown",this.watchForClosure),this.ui.dynamicData.input.removeEventListener("keypress",this.watchKeyInput),this.ui.dynamicData.input.removeEventListener("click",this.watchKeyInput),document.removeEventListener("click",this.watchForOutsideClick)},returnInputValue:e=>e.classList.contains("ql-editor")?e.textContent:e.value,getCaretPosition(e){if("INPUT"===e.tagName)return e.selectionEnd;let t=0;if(window.getSelection){const i=window.getSelection();if(i.rangeCount>0){const a=i.getRangeAt(0),n=a.cloneRange();n.selectNodeContents(e),n.setEnd(a.endContainer,a.endOffset),t=n.toString().length}}return t},inSearch(e){let t=e.label.toLowerCase(),i=e.name.toLowerCase(),a=this.ui.dynamicData.search.toLowerCase();return!(!t.includes(a)&&!i.includes(a))}},template:'\n    <Transition name="slide-down">\n      <div ref="dynamicdatamenu"  class="uip-border-rounder uip-shadow uip-border uip-position-fixed uip-background-default" v-if="ui.dynamicData.display" style="z-index:99999" :style="returndynamicDataMenuStyle">\n      \n        <div class="uip-padding-xs uip-flex uip-flex-column uip-row-gap-xs">\n        \n          <div class="uip-flex uip-flex-between uip-flex-center uip-min-w-200">\n          \n            <div class="">{{strings.dynamicData}}</div>\n            \n            <button class="uip-button-default uip-icon uip-border-rounder uip-padding-xxxs uip-link-muted" @click="closeDynamicData()">close</button>\n          \n          </div>\n          \n          <div class="uip-border-top"></div>\n          \n          <div class="uip-flex uip-flex-column uip-row-gap-xs">\n          \n            <div class="uip-flex uip-search-block uip-border-round uip-padding-xxs uip-padding-bottom-remove uip-flex uip-gap-xxs uip-flex-center">\n              <span class="uip-icon uip-text-muted uip-icon uip-icon-medium">search</span>\n              <input class="uip-blank-input uip-flex-grow uip-text-s" type="search" :placeholder="strings.searchData" autofocus="" v-model="ui.dynamicData.search">\n            </div>\n            \n          </div>  \n        \n        </div>\n          \n        <div class="uip-padding-xxs uip-flex uip-flex-column uip-max-h-200 uip-overflow-auto uip-row-gap-xs" id="uip-dynamic-list">\n          \n          <template v-for="cat in dynamicCategories">\n          \n            <div class="uip-padding-xs uip-padding-top-remove uip-padding-bottom-remove uip-margin-top-xxs uip-text-bold">{{cat.label}}</div>\n            \n            <div class="uip-flex uip-flex-column">\n            \n              <template v-for="(data, index) in dynamicOptionsWithSearch">\n                \n                <div v-if="cat.name == data.type" class="uip-padding-xs uip-padding-top-xxs uip-padding-bottom-xxs uip-link-muted hover:uip-background-muted uip-border-rounder uip-flex uip-flex-center uip-gap-xs" \n                @click="injectDynamicLabel(data)" :class="{\'uip-background-muted uip-text-emphasis\' : index == ui.dynamicData.index}" :id="data.name">\n                \n                  <span class="uip-icon">\n                    {{cat.icon}}\n                  </span>\n                  \n                  <span>{{data.label}}</span>\n                \n                </div>\n                \n              </template>\n              \n            </div>\n          \n          </template>\n        \n        </div>\n        \n      </div>\n    </Transition>\n          '}};